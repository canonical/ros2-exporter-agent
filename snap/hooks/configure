#!/bin/sh -e

STORAGE_SERVER="$(snapctl get storage-server)"

if [ -n "${STORAGE_SERVER}" ] && $(snapctl is-connected ssh-keys); then
    if snapctl services ${SNAP_INSTANCE_NAME}.synchronization | grep -q inactive; then
        logger -t ${SNAP_INSTANCE_NAME} "Storage server set, \
            starting the synchronization"
        snapctl start --enable $SNAP_INSTANCE_NAME.synchronization 2>&1 || true
    fi
fi
